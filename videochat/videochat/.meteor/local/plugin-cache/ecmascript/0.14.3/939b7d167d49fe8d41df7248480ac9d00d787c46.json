{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/marc/Escritorio/ETSETB/3B/SAD/SAD/videochat/videochat/packages/rocketchat:streamer/server/server.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.linux.x86_64"},"sourceFileName":"packages/rocketchat:streamer/server/server.js","filename":"/home/marc/Escritorio/ETSETB/3B/SAD/SAD/videochat/videochat/packages/rocketchat:streamer/server/server.js","passPerPreset":false,"envName":"development","cwd":"/home/marc/Escritorio/ETSETB/3B/SAD/SAD/videochat/videochat","root":"/home/marc/Escritorio/ETSETB/3B/SAD/SAD/videochat/videochat","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.9.2","helpers":true,"useESModules":false,"corejs":false}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/marc/Escritorio/ETSETB/3B/SAD/SAD/videochat/videochat/packages/rocketchat:streamer/server/server.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/rocketchat:streamer/server/server.js"}},"code":"/* globals EV */\n\n/* eslint new-cap: false */\nclass StreamerCentral extends EV {\n  constructor() {\n    super();\n    this.instances = {};\n  }\n\n}\n\nMeteor.StreamerCentral = new StreamerCentral();\nMeteor.Streamer = class Streamer extends EV {\n  constructor(name) {\n    let {\n      retransmit = true,\n      retransmitToSelf = false\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (Meteor.StreamerCentral.instances[name]) {\n      console.warn('Streamer instance already exists:', name);\n      return Meteor.StreamerCentral.instances[name];\n    }\n\n    super();\n    Meteor.StreamerCentral.instances[name] = this;\n    this.name = name;\n    this.retransmit = retransmit;\n    this.retransmitToSelf = retransmitToSelf;\n    this.subscriptions = [];\n    this.subscriptionsByEventName = {};\n    this.transformers = {};\n    this.iniPublication();\n    this.initMethod();\n    this._allowRead = {};\n    this._allowEmit = {};\n    this._allowWrite = {};\n    this.allowRead('none');\n    this.allowEmit('all');\n    this.allowWrite('none');\n  }\n\n  get name() {\n    return this._name;\n  }\n\n  set name(name) {\n    check(name, String);\n    this._name = name;\n  }\n\n  get subscriptionName() {\n    return \"stream-\".concat(this.name);\n  }\n\n  get retransmit() {\n    return this._retransmit;\n  }\n\n  set retransmit(retransmit) {\n    check(retransmit, Boolean);\n    this._retransmit = retransmit;\n  }\n\n  get retransmitToSelf() {\n    return this._retransmitToSelf;\n  }\n\n  set retransmitToSelf(retransmitToSelf) {\n    check(retransmitToSelf, Boolean);\n    this._retransmitToSelf = retransmitToSelf;\n  }\n\n  allowRead(eventName, fn) {\n    if (fn === undefined) {\n      fn = eventName;\n      eventName = '__all__';\n    }\n\n    if (typeof fn === 'function') {\n      return this._allowRead[eventName] = fn;\n    }\n\n    if (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n      console.error(\"allowRead shortcut '\".concat(fn, \"' is invalid\"));\n    }\n\n    if (fn === 'all' || fn === true) {\n      return this._allowRead[eventName] = function () {\n        return true;\n      };\n    }\n\n    if (fn === 'none' || fn === false) {\n      return this._allowRead[eventName] = function () {\n        return false;\n      };\n    }\n\n    if (fn === 'logged') {\n      return this._allowRead[eventName] = function () {\n        return Boolean(this.userId);\n      };\n    }\n  }\n\n  allowEmit(eventName, fn) {\n    if (fn === undefined) {\n      fn = eventName;\n      eventName = '__all__';\n    }\n\n    if (typeof fn === 'function') {\n      return this._allowEmit[eventName] = fn;\n    }\n\n    if (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n      console.error(\"allowRead shortcut '\".concat(fn, \"' is invalid\"));\n    }\n\n    if (fn === 'all' || fn === true) {\n      return this._allowEmit[eventName] = function () {\n        return true;\n      };\n    }\n\n    if (fn === 'none' || fn === false) {\n      return this._allowEmit[eventName] = function () {\n        return false;\n      };\n    }\n\n    if (fn === 'logged') {\n      return this._allowEmit[eventName] = function () {\n        return Boolean(this.userId);\n      };\n    }\n  }\n\n  allowWrite(eventName, fn) {\n    if (fn === undefined) {\n      fn = eventName;\n      eventName = '__all__';\n    }\n\n    if (typeof fn === 'function') {\n      return this._allowWrite[eventName] = fn;\n    }\n\n    if (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n      console.error(\"allowWrite shortcut '\".concat(fn, \"' is invalid\"));\n    }\n\n    if (fn === 'all' || fn === true) {\n      return this._allowWrite[eventName] = function () {\n        return true;\n      };\n    }\n\n    if (fn === 'none' || fn === false) {\n      return this._allowWrite[eventName] = function () {\n        return false;\n      };\n    }\n\n    if (fn === 'logged') {\n      return this._allowWrite[eventName] = function () {\n        return Boolean(this.userId);\n      };\n    }\n  }\n\n  isReadAllowed(scope, eventName, args) {\n    if (this._allowRead[eventName]) {\n      return this._allowRead[eventName].call(scope, eventName, ...args);\n    }\n\n    return this._allowRead['__all__'].call(scope, eventName, ...args);\n  }\n\n  isEmitAllowed(scope, eventName) {\n    for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n\n    if (this._allowEmit[eventName]) {\n      return this._allowEmit[eventName].call(scope, eventName, ...args);\n    }\n\n    return this._allowEmit['__all__'].call(scope, eventName, ...args);\n  }\n\n  isWriteAllowed(scope, eventName, args) {\n    if (this._allowWrite[eventName]) {\n      return this._allowWrite[eventName].call(scope, eventName, ...args);\n    }\n\n    return this._allowWrite['__all__'].call(scope, eventName, ...args);\n  }\n\n  addSubscription(subscription, eventName) {\n    this.subscriptions.push(subscription);\n\n    if (!this.subscriptionsByEventName[eventName]) {\n      this.subscriptionsByEventName[eventName] = [];\n    }\n\n    this.subscriptionsByEventName[eventName].push(subscription);\n  }\n\n  removeSubscription(subscription, eventName) {\n    const index = this.subscriptions.indexOf(subscription);\n\n    if (index > -1) {\n      this.subscriptions.splice(index, 1);\n    }\n\n    if (this.subscriptionsByEventName[eventName]) {\n      const index = this.subscriptionsByEventName[eventName].indexOf(subscription);\n\n      if (index > -1) {\n        this.subscriptionsByEventName[eventName].splice(index, 1);\n      }\n    }\n  }\n\n  transform(eventName, fn) {\n    if (typeof eventName === 'function') {\n      fn = eventName;\n      eventName = '__all__';\n    }\n\n    if (!this.transformers[eventName]) {\n      this.transformers[eventName] = [];\n    }\n\n    this.transformers[eventName].push(fn);\n  }\n\n  applyTransformers(methodScope, eventName, args) {\n    if (this.transformers['__all__']) {\n      this.transformers['__all__'].forEach(transform => {\n        args = transform.call(methodScope, eventName, args);\n        methodScope.tranformed = true;\n\n        if (!Array.isArray(args)) {\n          args = [args];\n        }\n      });\n    }\n\n    if (this.transformers[eventName]) {\n      this.transformers[eventName].forEach(transform => {\n        args = transform.call(methodScope, ...args);\n        methodScope.tranformed = true;\n\n        if (!Array.isArray(args)) {\n          args = [args];\n        }\n      });\n    }\n\n    return args;\n  }\n\n  iniPublication() {\n    const stream = this;\n    Meteor.publish(this.subscriptionName, function (eventName, options) {\n      check(eventName, String);\n      check(options, Match.OneOf(Boolean, {\n        useCollection: Boolean,\n        args: Array\n      }));\n      let useCollection,\n          args = [];\n\n      if (typeof options === 'boolean') {\n        useCollection = options;\n      } else {\n        if (options.useCollection) {\n          useCollection = options.useCollection;\n        }\n\n        if (options.args) {\n          args = options.args;\n        }\n      }\n\n      if (eventName.length === 0) {\n        this.stop();\n        return;\n      }\n\n      if (stream.isReadAllowed(this, eventName, args) !== true) {\n        this.stop();\n        return;\n      }\n\n      const subscription = {\n        subscription: this,\n        eventName: eventName\n      };\n      stream.addSubscription(subscription, eventName);\n      this.onStop(() => {\n        stream.removeSubscription(subscription, eventName);\n      });\n\n      if (useCollection === true) {\n        // Collection compatibility\n        this._session.sendAdded(stream.subscriptionName, 'id', {\n          eventName: eventName\n        });\n      }\n\n      this.ready();\n    });\n  }\n\n  initMethod() {\n    const stream = this;\n    const method = {};\n\n    method[this.subscriptionName] = function (eventName) {\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n\n      check(eventName, String);\n      check(args, Array);\n      this.unblock();\n\n      if (stream.isWriteAllowed(this, eventName, args) !== true) {\n        return;\n      }\n\n      const methodScope = {\n        userId: this.userId,\n        connection: this.connection,\n        originalParams: args,\n        tranformed: false\n      };\n      args = stream.applyTransformers(methodScope, eventName, args);\n      stream.emitWithScope(eventName, methodScope, ...args);\n\n      if (stream.retransmit === true) {\n        stream._emit(eventName, args, this.connection, true);\n      }\n    };\n\n    try {\n      Meteor.methods(method);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  _emit(eventName, args, origin, broadcast) {\n    if (broadcast === true) {\n      Meteor.StreamerCentral.emit('broadcast', this.name, eventName, args);\n    }\n\n    const subscriptions = this.subscriptionsByEventName[eventName];\n\n    if (!Array.isArray(subscriptions)) {\n      return;\n    }\n\n    subscriptions.forEach(subscription => {\n      if (this.retransmitToSelf === false && origin && origin === subscription.subscription.connection) {\n        return;\n      }\n\n      if (this.isEmitAllowed(subscription.subscription, eventName, ...args)) {\n        subscription.subscription._session.sendChanged(this.subscriptionName, 'id', {\n          eventName: eventName,\n          args: args\n        });\n      }\n    });\n  }\n\n  emit(eventName) {\n    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      args[_key3 - 1] = arguments[_key3];\n    }\n\n    this._emit(eventName, args, undefined, true);\n  }\n\n  emitWithoutBroadcast(eventName) {\n    for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n      args[_key4 - 1] = arguments[_key4];\n    }\n\n    this._emit(eventName, args, undefined, false);\n  }\n\n};","map":{"version":3,"sources":["packages/rocketchat:streamer/server/server.js"],"names":["StreamerCentral","EV","constructor","instances","Meteor","Streamer","name","retransmit","retransmitToSelf","console","warn","subscriptions","subscriptionsByEventName","transformers","iniPublication","initMethod","_allowRead","_allowEmit","_allowWrite","allowRead","allowEmit","allowWrite","_name","check","String","subscriptionName","_retransmit","Boolean","_retransmitToSelf","eventName","fn","undefined","indexOf","error","userId","isReadAllowed","scope","args","call","isEmitAllowed","isWriteAllowed","addSubscription","subscription","push","removeSubscription","index","splice","transform","applyTransformers","methodScope","forEach","tranformed","Array","isArray","stream","publish","options","Match","OneOf","useCollection","length","stop","onStop","_session","sendAdded","ready","method","unblock","connection","originalParams","emitWithScope","_emit","methods","e","origin","broadcast","emit","sendChanged","emitWithoutBroadcast"],"mappings":"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","sourcesContent":["/* globals EV */\n/* eslint new-cap: false */\n\nclass StreamerCentral extends EV {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.instances = {};\n\t}\n}\n\nMeteor.StreamerCentral = new StreamerCentral;\n\n\nMeteor.Streamer = class Streamer extends EV {\n\tconstructor(name, {retransmit = true, retransmitToSelf = false} = {}) {\n\t\tif (Meteor.StreamerCentral.instances[name]) {\n\t\t\tconsole.warn('Streamer instance already exists:', name);\n\t\t\treturn Meteor.StreamerCentral.instances[name];\n\t\t}\n\n\t\tsuper();\n\n\t\tMeteor.StreamerCentral.instances[name] = this;\n\n\t\tthis.name = name;\n\t\tthis.retransmit = retransmit;\n\t\tthis.retransmitToSelf = retransmitToSelf;\n\n\t\tthis.subscriptions = [];\n\t\tthis.subscriptionsByEventName = {};\n\t\tthis.transformers = {};\n\n\t\tthis.iniPublication();\n\t\tthis.initMethod();\n\n\t\tthis._allowRead = {};\n\t\tthis._allowEmit = {};\n\t\tthis._allowWrite = {};\n\n\t\tthis.allowRead('none');\n\t\tthis.allowEmit('all');\n\t\tthis.allowWrite('none');\n\t}\n\n\tget name() {\n\t\treturn this._name;\n\t}\n\n\tset name(name) {\n\t\tcheck(name, String);\n\t\tthis._name = name;\n\t}\n\n\tget subscriptionName() {\n\t\treturn `stream-${this.name}`;\n\t}\n\n\tget retransmit() {\n\t\treturn this._retransmit;\n\t}\n\n\tset retransmit(retransmit) {\n\t\tcheck(retransmit, Boolean);\n\t\tthis._retransmit = retransmit;\n\t}\n\n\tget retransmitToSelf() {\n\t\treturn this._retransmitToSelf;\n\t}\n\n\tset retransmitToSelf(retransmitToSelf) {\n\t\tcheck(retransmitToSelf, Boolean);\n\t\tthis._retransmitToSelf = retransmitToSelf;\n\t}\n\n\tallowRead(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowRead[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowRead shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tallowEmit(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowEmit[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowRead shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tallowWrite(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowWrite[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowWrite shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tisReadAllowed(scope, eventName, args) {\n\t\tif (this._allowRead[eventName]) {\n\t\t\treturn this._allowRead[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowRead['__all__'].call(scope, eventName, ...args);\n\t}\n\n\tisEmitAllowed(scope, eventName, ...args) {\n\t\tif (this._allowEmit[eventName]) {\n\t\t\treturn this._allowEmit[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowEmit['__all__'].call(scope, eventName, ...args);\n\t}\n\n\tisWriteAllowed(scope, eventName, args) {\n\t\tif (this._allowWrite[eventName]) {\n\t\t\treturn this._allowWrite[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowWrite['__all__'].call(scope, eventName, ...args);\n\t}\n\n\taddSubscription(subscription, eventName) {\n\t\tthis.subscriptions.push(subscription);\n\n\t\tif (!this.subscriptionsByEventName[eventName]) {\n\t\t\tthis.subscriptionsByEventName[eventName] = [];\n\t\t}\n\n\t\tthis.subscriptionsByEventName[eventName].push(subscription);\n\t}\n\n\tremoveSubscription(subscription, eventName) {\n\t\tconst index = this.subscriptions.indexOf(subscription);\n\t\tif (index > -1) {\n\t\t\tthis.subscriptions.splice(index, 1);\n\t\t}\n\n\t\tif (this.subscriptionsByEventName[eventName]) {\n\t\t\tconst index = this.subscriptionsByEventName[eventName].indexOf(subscription);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.subscriptionsByEventName[eventName].splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\ttransform(eventName, fn) {\n\t\tif (typeof eventName === 'function') {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (!this.transformers[eventName]) {\n\t\t\tthis.transformers[eventName] = [];\n\t\t}\n\n\t\tthis.transformers[eventName].push(fn);\n\t}\n\n\tapplyTransformers(methodScope, eventName, args) {\n\t\tif (this.transformers['__all__']) {\n\t\t\tthis.transformers['__all__'].forEach((transform) => {\n\t\t\t\targs = transform.call(methodScope, eventName, args);\n\t\t\t\tmethodScope.tranformed = true;\n\t\t\t\tif (!Array.isArray(args)) {\n\t\t\t\t\targs = [args];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.transformers[eventName]) {\n\t\t\tthis.transformers[eventName].forEach((transform) => {\n\t\t\t\targs = transform.call(methodScope, ...args);\n\t\t\t\tmethodScope.tranformed = true;\n\t\t\t\tif (!Array.isArray(args)) {\n\t\t\t\t\targs = [args];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn args;\n\t}\n\n\tiniPublication() {\n\t\tconst stream = this;\n\t\tMeteor.publish(this.subscriptionName, function(eventName, options) {\n\t\t\tcheck(eventName, String);\n\t\t\tcheck(options, Match.OneOf(Boolean, {\n\t\t\t\tuseCollection: Boolean,\n\t\t\t\targs: Array,\n\t\t\t}));\n\n\t\t\tlet useCollection, args = [];\n\n\t\t\tif (typeof options === 'boolean') {\n\t\t\t\tuseCollection = options;\n\t\t\t} else {\n\t\t\t\tif (options.useCollection) {\n\t\t\t\t\tuseCollection = options.useCollection;\n\t\t\t\t}\n\n\t\t\t\tif (options.args) {\n\t\t\t\t\targs = options.args;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (eventName.length === 0) {\n\t\t\t\tthis.stop();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (stream.isReadAllowed(this, eventName, args) !== true) {\n\t\t\t\tthis.stop();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst subscription = {\n\t\t\t\tsubscription: this,\n\t\t\t\teventName: eventName\n\t\t\t};\n\n\t\t\tstream.addSubscription(subscription, eventName);\n\n\t\t\tthis.onStop(() => {\n\t\t\t\tstream.removeSubscription(subscription, eventName);\n\t\t\t});\n\n\t\t\tif (useCollection === true) {\n\t\t\t\t// Collection compatibility\n\t\t\t\tthis._session.sendAdded(stream.subscriptionName, 'id', {\n\t\t\t\t\teventName: eventName\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.ready();\n\t\t});\n\t}\n\n\tinitMethod() {\n\t\tconst stream = this;\n\t\tconst method = {};\n\n\t\tmethod[this.subscriptionName] = function(eventName, ...args) {\n\t\t\tcheck(eventName, String);\n\t\t\tcheck(args, Array);\n\n\t\t\tthis.unblock();\n\n\t\t\tif (stream.isWriteAllowed(this, eventName, args) !== true) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst methodScope = {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnection: this.connection,\n\t\t\t\toriginalParams: args,\n\t\t\t\ttranformed: false\n\t\t\t};\n\n\t\t\targs = stream.applyTransformers(methodScope, eventName, args);\n\n\t\t\tstream.emitWithScope(eventName, methodScope, ...args);\n\n\t\t\tif (stream.retransmit === true) {\n\t\t\t\tstream._emit(eventName, args, this.connection, true);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\tMeteor.methods(method);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n\n\t_emit(eventName, args, origin, broadcast) {\n\t\tif (broadcast === true) {\n\t\t\tMeteor.StreamerCentral.emit('broadcast', this.name, eventName, args);\n\t\t}\n\n\t\tconst subscriptions = this.subscriptionsByEventName[eventName];\n\t\tif (!Array.isArray(subscriptions)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsubscriptions.forEach((subscription) => {\n\t\t\tif (this.retransmitToSelf === false && origin && origin === subscription.subscription.connection) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isEmitAllowed(subscription.subscription, eventName, ...args)) {\n\t\t\t\tsubscription.subscription._session.sendChanged(this.subscriptionName, 'id', {\n\t\t\t\t\teventName: eventName,\n\t\t\t\t\targs: args\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\temit(eventName, ...args) {\n\t\tthis._emit(eventName, args, undefined, true);\n\t}\n\n\temitWithoutBroadcast(eventName, ...args) {\n\t\tthis._emit(eventName, args, undefined, false);\n\t}\n};\n"]},"sourceType":"module","hash":"939b7d167d49fe8d41df7248480ac9d00d787c46"}
