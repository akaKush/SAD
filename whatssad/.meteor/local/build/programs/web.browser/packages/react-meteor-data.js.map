{"version":3,"sources":["meteor://ðŸ’»app/packages/react-meteor-data/index.js","meteor://ðŸ’»app/packages/react-meteor-data/useTracker.ts","meteor://ðŸ’»app/packages/react-meteor-data/withTracker.tsx"],"names":["React","module","link","default","v","Meteor","isDevelopment","version","split","console","warn"],"mappings":"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","file":"/packages/react-meteor-data.js","sourcesContent":["/* global Meteor*/\nimport React from 'react';\n\nif (Meteor.isDevelopment) {\n  const v = React.version.split('.');\n  if (v[0] < 16 || (v[0] == 16 && v[1] < 8)) {\n    console.warn('react-meteor-data 2.x requires React version >= 16.8.');\n  }\n}\n\nexport { default as useTracker } from './useTracker';\nexport { default as withTracker } from './withTracker.tsx';\n","declare var Package: any\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { useReducer, useEffect, useRef, useMemo } from 'react';\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor(data: any): void {\n  let shouldWarn = false;\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach((key) => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n  if (shouldWarn) {\n    console.warn(\n      'Warning: your reactive function is returning a Mongo cursor. '\n      + 'This value will not be reactive. You probably want to call '\n      + '`.fetch()` on the cursor before returning it.'\n    );\n  }\n}\n\n// Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\nconst fur = (x: number): number => x + 1;\nconst useForceUpdate = (): CallableFunction => {\n  const [, forceUpdate] = useReducer(fur, 0);\n  return forceUpdate;\n}\n\ntype ReactiveFn = (c?: Tracker.Computation) => any;\ntype ComputationHandler = (c: Tracker.Computation) => () => void | void;\ntype TrackerRefs = {\n  reactiveFn: ReactiveFn;\n  computationHandler?: ComputationHandler;\n  deps?: Array<any>;\n  computation?: Tracker.Computation;\n  isMounted: boolean;\n  disposeId?: ReturnType<typeof setTimeout>;\n  trackerData: any;\n  computationCleanup?: () => void;\n  trackerCount?: number\n}\n\n// The follow functions were hoisted out of the closure to reduce allocations.\n// Since they no longer have access to the local vars, we pass them in and mutate here.\nconst dispose = (refs: TrackerRefs): void => {\n  if (refs.computationCleanup) {\n    refs.computationCleanup();\n    delete refs.computationCleanup;\n  }\n  if (refs.computation) {\n    refs.computation.stop();\n    refs.computation = null;\n  }\n};\n\nconst runReactiveFn = Meteor.isDevelopment\n  ? (refs: TrackerRefs, c: Tracker.Computation): void => {\n    const data = refs.reactiveFn(c);\n    checkCursor(data);\n    refs.trackerData = data;\n  }\n  : (refs: TrackerRefs, c: Tracker.Computation): void => {\n    refs.trackerData = refs.reactiveFn(c);\n  };\n\nconst clear = (refs: TrackerRefs): void => {\n  if (refs.disposeId) {\n    clearTimeout(refs.disposeId);\n    delete refs.disposeId;\n  }\n};\n\nconst track = (refs: TrackerRefs, forceUpdate: Function, trackedFn: Function): void => {\n  // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n  Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n    refs.computation = c;\n    trackedFn(c, refs, forceUpdate);\n  }));\n};\n\nconst doFirstRun = (refs: TrackerRefs, c: Tracker.Computation): void => {\n  // If there is a computationHandler, pass it the computation, and store the\n  // result, which may be a cleanup method.\n  if (refs.computationHandler) {\n    const cleanupHandler = refs.computationHandler(c);\n    if (cleanupHandler) {\n      if (Meteor.isDevelopment && typeof cleanupHandler !== 'function') {\n        console.warn(\n          'Warning: Computation handler should return a function '\n          + 'to be used for cleanup or return nothing.'\n        );\n      }\n      refs.computationCleanup = cleanupHandler;\n    }\n  }\n  // Always run the reactiveFn on firstRun\n  runReactiveFn(refs, c);\n}\n\nconst tracked = (c: Tracker.Computation, refs: TrackerRefs, forceUpdate: Function): void => {\n  if (c.firstRun) {\n    doFirstRun(refs, c);\n  } else {\n    if (refs.isMounted) {\n      // Only run the reactiveFn if the component is mounted.\n      runReactiveFn(refs, c);\n      forceUpdate();\n    } else {\n      // If we got here, then a reactive update happened before the render was\n      // committed - before useEffect has run. We don't want to run the reactiveFn\n      // while we are not sure this render will be committed, so we'll dispose of the\n      // computation, and set everything up to be restarted in useEffect if needed.\n      // NOTE: If we don't run the user's reactiveFn when a computation updates, we'll\n      // leave the computation in a non-reactive state - so we need to dispose here\n      // and let useEffect recreate the computation later.\n      dispose(refs);\n      // Might as well clear the timeout!\n      clear(refs);\n    }\n  }\n};\n\ninterface useTrackerSignature {\n  (reactiveFn: ReactiveFn, deps?: null | Array<any>, computationHandler?: ComputationHandler): any\n}\n\nconst useTrackerNoDeps: useTrackerSignature = (reactiveFn, deps = null, computationHandler) => {\n  const { current: refs } = useRef<TrackerRefs>({\n    reactiveFn,\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate();\n\n  refs.reactiveFn = reactiveFn;\n  if (computationHandler) {\n    refs.computationHandler = computationHandler;\n  }\n\n  // Without deps, always dispose and recreate the computation with every render.\n  dispose(refs);\n  track(refs, forceUpdate, (c: Tracker.Computation) => {\n    if (c.firstRun) {\n      doFirstRun(refs, c);\n    } else {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  });\n\n  // To avoid creating side effects in render with Tracker when not using deps\n  // create the computation, run the user's reactive function in a computation synchronously,\n  // then immediately dispose of it. It'll be recreated again after the render is committed.\n  if (!refs.isMounted) {\n    // We want to forceUpdate in useEffect to support StrictMode.\n    // See: https://github.com/meteor/react-packages/issues/278\n    dispose(refs);\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is comitted).\n    refs.isMounted = true;\n\n    // Render is committed. Since useTracker without deps always runs synchronously,\n    // forceUpdate and let the next render recreate the computation.\n    forceUpdate();\n\n    // stop the computation on unmount\n    return () => dispose(refs);\n  }, []);\n\n  return refs.trackerData;\n}\n\nconst useTrackerWithDeps: useTrackerSignature = (reactiveFn, deps: Array<any>, computationHandler) => {\n  const { current: refs } = useRef<TrackerRefs>({\n    reactiveFn,\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate();\n\n  // Always have up to date deps and computations in all contexts\n  refs.reactiveFn = reactiveFn;\n  refs.deps = deps;\n  if (computationHandler) {\n    refs.computationHandler = computationHandler;\n  }\n\n  // We are abusing useMemo a little bit, using it for it's deps\n  // compare, but not for it's memoization.\n  useMemo(() => {\n    // stop the old one.\n    dispose(refs);\n\n    track(refs, forceUpdate, tracked)\n\n    // Tracker creates side effect in render, which can be problematic in some cases, such as\n    // Suspense or concurrent rendering or if an error is thrown and handled by an error boundary.\n    // We still want synchronous rendering for a number of reasons (see readme). useTracker works\n    // around memory/resource leaks by setting a time out to automatically clean everything up,\n    // and watching a set of references to make sure everything is choreographed correctly.\n    if (!refs.isMounted) {\n      // Components yield to allow the DOM to update and the browser to paint before useEffect\n      // is run. In concurrent mode this can take quite a long time. 1000ms should be enough\n      // in most cases.\n      refs.disposeId = setTimeout(() => {\n        if (!refs.isMounted) {\n          dispose(refs);\n        }\n      }, 1000);\n    }\n  }, deps);\n\n  useEffect(() => {\n    refs.isMounted = true;\n\n    // Render is committed, clear the dispose timeout\n    clear(refs);\n\n    // If it took longer than 1000ms to get to useEffect, or a reactive update happened\n    // before useEffect, restart the computation and forceUpdate.\n    if (!refs.computation) {\n      // This also runs runReactiveFn\n      track(refs, forceUpdate, tracked);\n      forceUpdate();\n    }\n\n    // stop the computation on unmount\n    return () => dispose(refs);\n  }, []);\n\n  return refs.trackerData;\n}\n\nconst useTrackerClient: useTrackerSignature = (reactiveFn, deps = null, computationHandler) =>\n  (deps === null || deps === undefined || !Array.isArray(deps))\n    ? useTrackerNoDeps(reactiveFn, deps, computationHandler)\n    : useTrackerWithDeps(reactiveFn, deps, computationHandler);\n\nconst useTrackerServer: useTrackerSignature = (reactiveFn, deps = null, computationHandler) =>\n  Tracker.nonreactive(reactiveFn);\n\n// When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\nconst useTracker = Meteor.isServer\n  ? useTrackerServer\n  : useTrackerClient;\n\nconst useTrackerDev: useTrackerSignature = (reactiveFn, deps = null, computationHandler) => {\n  if (typeof reactiveFn !== 'function') {\n    console.warn(\n      'Warning: useTracker expected a function in it\\'s first argument '\n      + `(reactiveFn), but got type of ${typeof reactiveFn}.`\n    );\n  }\n  if (deps && !Array.isArray(deps)) {\n    console.warn(\n      'Warning: useTracker expected an array in it\\'s second argument '\n      + `(dependency), but got type of ${typeof deps}.`\n    );\n  }\n  if (computationHandler && typeof computationHandler !== 'function') {\n    console.warn(\n      'Warning: useTracker expected a function in it\\'s third argument'\n      + `(computationHandler), but got type of ${typeof computationHandler}.`\n    );\n  }\n  return useTracker(reactiveFn, deps, computationHandler);\n}\n\nexport default Meteor.isDevelopment\n  ? useTrackerDev\n  : useTracker;\n","import React, { forwardRef, memo } from 'react';\nimport useTracker from './useTracker';\n\ntype ReactiveFn = (props: object) => any;\ntype ReactiveOptions = {\n  getMeteorData: ReactiveFn;\n  pure?: boolean;\n}\n\nexport default function withTracker(options: ReactiveFn | ReactiveOptions) {\n  return (Component: React.ComponentType) => {\n    const getMeteorData = typeof options === 'function'\n      ? options\n      : options.getMeteorData;\n\n    const WithTracker = forwardRef((props, ref) => {\n      const data = useTracker(() => getMeteorData(props) || {});\n      return (\n        <Component ref={ref} {...props} {...data} />\n      );\n    });\n\n    // @ts-ignore\n    const { pure = true } = options;\n    return pure ? memo(WithTracker) : WithTracker;\n  }\n};\n"]}